# Proposal: 题库管理增强与Docker部署

## Context

用户需要为AI面试助手增强题库管理功能并添加Docker部署支持。当前系统是一个Vue 3 + FastAPI的面试练习应用，支持单题练习和套卷练习，但题库管理功能较为基础，缺乏批量操作和从题库直接进入练习的能力。

### 现状分析

**前端技术栈**: Vue 3 + Vite + Element Plus + Pinia
**后端技术栈**: FastAPI + SQLAlchemy + SQLite (async)
**部署现状**: 宝塔面板手动部署，无Docker支持

**现有约束**:
- 题库管理页(`RepositoryView.vue`)已有单题型筛选和关键词搜索
- 删除操作仅支持单条删除(`DELETE /api/v1/questions/{id}`)
- 练习结果页的"继续练习"按钮触发全局重置，丢失当前题目上下文
- 前端API请求已支持`VITE_API_BASE_URL`环境变量注入
- 数据存储在SQLite文件和uploads目录，需持久化

---

## Requirements

### R1: 题库多题型筛选

**场景**: 用户希望同时查看"综合分析"和"组织协调"两种题型的题目。

**验收标准**:
- 题型筛选下拉框支持多选模式
- 后端`GET /api/v1/questions`接口支持`category`参数接收逗号分隔的多值
- 选中多个题型时，显示所有匹配题型的题目

### R2: 题目多选与全选

**场景**: 用户需要批量管理题目（删除或开始练习）。

**验收标准**:
- 题目列表表格增加多选列（checkbox）
- 提供"全选当前页"功能
- 选中状态在分页切换时保持（可选：跨页选中或仅当前页）
- 工具栏显示已选中题目数量

### R3: 批量删除题目

**场景**: 用户选中多道不需要的题目后，一键删除。

**验收标准**:
- 选中题目后，工具栏显示"删除选中"按钮
- 点击后弹出确认对话框，显示将删除的题目数量
- 后端新增`POST /api/v1/questions/batch-delete`接口，接收题目ID列表
- 删除成功后刷新列表并清空选中状态
- 处理关联数据：删除前检查是否有关联的答题记录，有则提示用户

### R4: 从题库开始练习

**场景**: 用户在题库管理页选中题目后，直接以这些题目开始练习。

**验收标准**:
- 选中题目后，工具栏显示"开始练习"按钮
- 选中1道题目时：跳转到单题练习，直接进入作答阶段（跳过选题）
- 选中多道题目时：弹窗让用户设置练习时限（默认15分钟），然后跳转到套卷练习
- 练习流程复用现有组件，仅需传递题目数据

### R5: 再次练习功能

**场景**: 用户完成练习后，希望用同样的题目再练一次。

**验收标准**:
- 单题练习结果页增加"再次练习"按钮
- 套卷练习结果页增加"再次练习"按钮
- 点击后保留当前题目，重置答题状态和计时器，回到作答阶段
- 原有"继续练习"按钮保留，功能不变（返回选题页）

### R6: Docker部署支持

**场景**: 运维人员需要在云服务器上使用Docker快速部署应用。

**验收标准**:
- 创建`backend/Dockerfile`：基于Python 3.10，安装依赖，使用gunicorn运行
- 创建`frontend/Dockerfile`：多阶段构建，先npm build再用Nginx托管静态文件
- 创建根目录`docker-compose.yml`：编排前后端服务
- 后端容器暴露8000端口，前端Nginx容器暴露80端口
- Nginx配置`/api`路径反向代理到后端
- 数据卷挂载：`./data`(数据库) 和 `./uploads`(上传文件)
- 提供`.env.example`示例环境变量文件
- 更新README添加Docker部署说明

---

## Constraints

### Hard Constraints (技术限制)

1. **框架约束**: 必须使用现有的Vue 3 + FastAPI技术栈
2. **数据库约束**: SQLite不支持并发写入，批量删除需在单个事务中完成
3. **关联数据约束**: Question与Answer有外键关联，删除时需处理关联记录
4. **路由约束**: 现有路由结构不变，新功能通过query参数或新路由添加

### Soft Constraints (约定/偏好)

1. **UI约定**: 使用Element Plus组件库风格一致
2. **API约定**: RESTful风格，版本前缀`/api/v1`
3. **代码约定**: TypeScript严格模式，Python异步IO

### Dependencies (跨模块依赖)

1. R4依赖R2（需要先实现多选才能从题库开始练习）
2. R3依赖R2（需要先实现多选才能批量删除）
3. R6独立，可并行开发

---

## Success Criteria (验收判据)

1. **筛选功能**: 选择"综合分析"+"组织协调"两个题型，列表仅显示这两类题目
2. **多选功能**: 勾选3道题目，工具栏显示"已选3题"
3. **批量删除**: 选中5道题目，点击删除，确认后列表减少5条记录
4. **从题库练习**: 选中2道题目，点击练习，设置时限后进入套卷模式
5. **再次练习**: 完成单题练习后，点击"再次练习"，同一题目重新计时作答
6. **Docker部署**: 执行`docker compose up -d`后，通过`http://服务器IP`访问应用正常
7. **前后端通信**: Docker部署后，前端页面可正常调用后端API（录音、分析等）

---

## Risks & Mitigations

| 风险 | 影响 | 缓解策略 |
|------|------|----------|
| SQLite文件锁定 | 批量删除时其他请求被阻塞 | 使用aiosqlite异步，单事务快速完成 |
| 删除关联数据 | 误删有价值的答题记录 | 删除前提示关联记录数，需用户二次确认 |
| 跨页选中复杂度 | 实现成本高，用户体验不明显 | 第一版仅支持当前页选中，后续迭代可增强 |
| Docker镜像体积 | 首次部署下载慢 | 使用多阶段构建优化镜像大小 |

---

## Implementation Order (建议)

1. **Phase 1**: R2 (多选/全选) - 基础能力
2. **Phase 2**: R1 (多题型筛选) + R3 (批量删除) - 可并行
3. **Phase 3**: R4 (从题库练习) + R5 (再次练习) - 可并行
4. **Phase 4**: R6 (Docker部署) - 独立模块
